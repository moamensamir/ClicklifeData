<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clicklife — Data</title>

  <!-- Fonts: Cairo only for clarity -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-dark: #071226;
      --muted: #c7d2e6;
      --accent: #f59e0b;  /* ذهبي / برتقالي */
      --accent-2: #0ea56a;
      --card-bg: rgba(2,8,23,0.66); /* أقوى خلفية للبطاقات لتباين أعلى */
      --row-bg: rgba(255,255,255,0.02);
      --input-bg: rgba(255,255,255,0.04);
      --radius: 12px;
      font-family: 'Cairo', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color-scheme: dark;
    }

    html,body{height:100%;margin:0;background:var(--bg-dark);color:#ffffff}
    body{
      /* استخدم الصورة الخلفية باسم bg.jpg في نفس المجلد */
      background-image: url('bg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* شفافية مظللة للخلفية لضمان تباين النص */
    .overlay {
      position:fixed; inset:0; background: linear-gradient(180deg, rgba(7,18,38,0.72), rgba(7,18,38,0.72));
      z-index:-1;
    }

    .container{max-width:1100px;margin:28px auto;padding:18px;display:block}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#6f8cff,#0f62fe);
      display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:20px;box-shadow:0 8px 30px rgba(15,98,254,0.12)
    }
    h1{font-size:20px;margin:0;color:#fff}
    .desc{color:var(--muted);font-size:13px;margin-top:4px}

    /* hero */
    .hero{
      background: var(--card-bg);
      border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6);
      display:flex;flex-direction:column;gap:14px;min-height:240px;
    }

    .hero-top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .hero-text{max-width:68%}
    .hero-text h2{margin:0;font-size:22px;color:#fff}
    .hero-text p{margin:6px 0 0 0;color:var(--muted);font-size:14px}

    .big-actions{display:flex;gap:10px;align-items:center}
    .btn{
      padding:10px 14px;border-radius:12px;border:0;font-weight:700;cursor:pointer;
      background:var(--accent); color:#071226; box-shadow:0 8px 20px rgba(245,158,11,0.12);
    }
    .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.12)}
    .btn.secondary{background:#0b1726;color:#fff;border:1px solid rgba(255,255,255,0.06)}
    .btn.small{padding:8px 10px;border-radius:10px;font-weight:600}

    .search{display:flex;gap:8px;align-items:center;margin-top:6px}
    input[type="search"]{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);
      background: var(--input-bg); color:#fff; font-size:15px; outline:none;
    }
    input[type="search"]::placeholder{ color:#c7d2e6 }

    .panel{background: transparent;border-radius:12px;padding:12px}
    .list{margin-top:10px;display:flex;flex-direction:column;gap:10px;max-height:420px;overflow:auto;padding-right:6px}
    .row{
      display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04)
    }
    .row .left{display:flex;align-items:center;gap:12px}
    .avatar{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#ffb84d,#c56a00);display:flex;align-items:center;justify-content:center;color:#071226;font-weight:800}
    .name{font-weight:700;color:#fff}
    .meta{color:var(--muted);font-size:13px}

    .note{font-size:13px;color:var(--muted);text-align:center;margin-top:12px}

    /* modal */
    .modalBackdrop{position:fixed;inset:0;background:rgba(0,0,0,0.66);display:flex;align-items:center;justify-content:center;z-index:1000}
    .modal{background:rgba(8,12,20,0.98);padding:18px;border-radius:12px;width:460px;border:1px solid rgba(255,255,255,0.04);color:#fff}
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
    input, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-bottom:8px}

    @media(max-width:640px){
      .hero-text{max-width:100%}
      .container{padding:12px}
      .hero{min-height:180px}
    }
  </style>
</head>
<body>
  <div class="overlay" aria-hidden="true"></div>

  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">CL</div>
        <div>
          <h1>Clicklife</h1>
          <div class="desc"></div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <label for="file" class="btn secondary" title="Import Excel">Import Excel</label>
        <input id="file" type="file" accept=".xlsx,.xls" style="display:none" />
        <button id="btnAdd" class="btn">Add Excel</button>
        <button id="btnExport" class="btn ghost">Export</button>
      </div>
    </header>

    <section class="hero" style="margin-top:18px">
      <div class="hero-top">
        <div class="hero-text">
          <h2></h2>
          <p></p>
        </div>

        <div class="big-actions" aria-hidden="false">
          <button id="btnImportSample" class="btn small">Please dont touch no need</button>
          <button id="btnClear" class="btn small" style="background:#ff6b6b;color:white">مسح</button>
        </div>
      </div>

      <div class="search">
        <input id="search" type="search" placeholder="اكتب اسم العميل... (مثال: أحمد)" />
      </div>

      <div class="panel" style="margin-top:6px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div class="meta">العملاء: <span id="countCustomers">0</span></div>
          <div class="meta">الأرقام: <span id="countPhones">0</span></div>
        </div>

        <div id="list" class="list" aria-live="polite">
          <div class="meta" style="padding:14px">لا توجد بيانات — استورد ملف أو أضف عميل جديد</div>
        </div>
      </div>
    </section>

    <div class="note"></div>
  </div>

  <div id="modalRoot"></div>

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    // simplified JS with id removed from UI and improved contrast
    const LS_KEY = 'clicklife_simple_v1';
    let state = { customers: [] };

    function uid(prefix='id'){ return prefix + '_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2,8); }
    function normName(s){ return (s||'').toString().normalize('NFKD').replace(/[\u064B-\u0652]/g,'').trim().toLowerCase().replace(/\s+/g,' '); }
    function normPhone(p){ return (p||'').toString().replace(/[^0-9+]/g,'').replace(/^0+/,'0'); }
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); renderCounts(); }
    function loadState(){ const raw = localStorage.getItem(LS_KEY); if(raw){ try{ state = JSON.parse(raw); }catch(e){ state = {customers:[]} } } else state = {customers:[]}; }

    function renderCounts(){
      const customers = state.customers.length;
      const phones = state.customers.reduce((s,c)=>s + (c.phones?.length||0),0);
      document.getElementById('countCustomers').textContent = customers;
      document.getElementById('countPhones').textContent = phones;
    }

    function makeAvatarText(name){
      if(!name) return 'CL';
      const a = name.split(' ').filter(Boolean).slice(0,2).map(x=>x[0]).join('').toUpperCase();
      return a || 'CL';
    }

    function renderList(filter=''){
      const listEl = document.getElementById('list');
      listEl.innerHTML = '';
      let items = state.customers;
      if(filter) {
        const q = normName(filter);
        items = items.filter(c => c.name_norm.includes(q));
      }
      if(items.length === 0){
        listEl.innerHTML = '<div class="meta" style="padding:14px">لا توجد نتائج</div>';
        renderCounts();
        return;
      }
      items.forEach(c=>{
        const row = document.createElement('div'); row.className='row';
        const left = document.createElement('div'); left.className='left';
        const av = document.createElement('div'); av.className='avatar'; av.textContent = makeAvatarText(c.name);
        const txt = document.createElement('div');
        txt.innerHTML = `<div class="name">${escapeHtml(c.name)}</div><div class="meta">${(c.phones?.length||0)} أرقام</div>`;
        left.appendChild(av); left.appendChild(txt);
        row.appendChild(left);

        const actions = document.createElement('div'); actions.style.display = 'flex'; actions.style.gap = '8px';
        const btnView = document.createElement('button'); btnView.className='btn secondary'; btnView.textContent='عرض';
        btnView.addEventListener('click', ()=> openDetail(c.id));
        const btnAdd = document.createElement('button'); btnAdd.className='btn ghost'; btnAdd.textContent='رقم';
        btnAdd.addEventListener('click', ()=> {
          const ph = prompt('أدخل الرقم الجديد للعميل ' + c.name);
          if(!ph) return;
          const res = addPhoneToCustomer(c.id, ph.trim());
          if(!res.ok) alert(res.msg); else { saveState(); renderList(document.getElementById('search').value); }
        });
        actions.appendChild(btnAdd); actions.appendChild(btnView);
        row.appendChild(actions);

        listEl.appendChild(row);
      });
      renderCounts();
    }

    function findCustomerByNameNorm(nn){ return state.customers.find(c => c.name_norm === nn); }
    function addOrGetCustomerByName(name){
      const nn = normName(name||'');
      let c = findCustomerByNameNorm(nn);
      if(!c){
        c = { id: uid('c'), name: (name||'').toString().trim(), name_norm: nn, phones: [] };
        state.customers.push(c);
      } else {
        if(!c.name && name) c.name = name;
      }
      return c;
    }
    function addPhoneToCustomer(customerId, phone){
      const pnorm = normPhone(phone);
      if(!pnorm) return {ok:false, msg:'الرقم غير صالح'};
      const cust = state.customers.find(x=>x.id===customerId);
      if(!cust) return {ok:false, msg:'العميل غير موجود'};
      if(cust.phones.find(p=>p.phone_norm === pnorm)) return {ok:false, msg:'الرقم موجود بالفعل'};
      const ph = { id: uid('p'), phone: phone.toString().trim(), phone_norm: pnorm };
      cust.phones.push(ph);
      saveState();
      return {ok:true, phone:ph};
    }

    function deleteAll(){
      if(!confirm('هل تريد حقاً مسح كل البيانات؟')) return;
      localStorage.removeItem(LS_KEY);
      loadState();
      renderList();
      renderCounts();
    }

    function openDetail(customerId){
      const c = state.customers.find(x=>x.id===customerId);
      if(!c) return;
      const root = document.getElementById('modalRoot');
      root.innerHTML = '';
      const backdrop = document.createElement('div'); backdrop.className='modalBackdrop';
      const modal = document.createElement('div'); modal.className='modal';
      modal.innerHTML = `<div style="display:flex;gap:12px;align-items:center;margin-bottom:10px">
        <div style="width:60px;height:60px;border-radius:10px;background:linear-gradient(135deg,#ffb84d,#c56a00);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071226">${makeAvatarText(c.name)}</div>
        <div><div style="font-weight:800">${escapeHtml(c.name)}</div></div>
      </div>`;

      const phonesList = document.createElement('div');
      if((c.phones||[]).length === 0){
        phonesList.innerHTML = '<div class="meta">لا توجد أرقام</div>';
      } else {
        c.phones.forEach(ph=>{
          const r = document.createElement('div'); r.style.display='flex'; r.style.justifyContent='space-between'; r.style.alignItems='center'; r.style.padding='8px 0';
          r.innerHTML = `<div><strong>${escapeHtml(ph.phone)}</strong></div>`;
          const group = document.createElement('div');
          const copyBtn = document.createElement('button'); copyBtn.className='btn secondary'; copyBtn.textContent='نسخ';
          copyBtn.addEventListener('click', ()=> { navigator.clipboard?.writeText(ph.phone); alert('تم النسخ: ' + ph.phone); });
          const delBtn = document.createElement('button'); delBtn.className='btn ghost'; delBtn.textContent='حذف';
          delBtn.addEventListener('click', ()=> {
            if(!confirm('حذف الرقم؟')) return;
            c.phones = c.phones.filter(x=>x.id!==ph.id);
            saveState();
            openDetail(customerId);
          });
          group.appendChild(copyBtn); group.appendChild(delBtn);
          r.appendChild(group);
          phonesList.appendChild(r);
        });
      }
      modal.appendChild(phonesList);

      const addWrap = document.createElement('div'); addWrap.style.marginTop='12px';
      addWrap.innerHTML = `<label style="color:var(--muted)">أضف رقم جديد</label><input id="newPhone" placeholder="مثال: 01012345678"/>`;
      const saveBtn = document.createElement('button'); saveBtn.className='btn'; saveBtn.textContent='حفظ';
      saveBtn.addEventListener('click', ()=>{
        const v = document.getElementById('newPhone').value.trim();
        if(!v) return alert('أدخل الرقم');
        const res = addPhoneToCustomer(customerId, v);
        if(!res.ok) alert(res.msg); else { openDetail(customerId); renderList(); }
      });
      addWrap.appendChild(saveBtn);
      modal.appendChild(addWrap);

      const close = document.createElement('div'); close.style.marginTop='12px'; close.style.textAlign='right';
      const closeBtn = document.createElement('button'); closeBtn.className='btn ghost'; closeBtn.textContent='إغلاق';
      closeBtn.addEventListener('click', ()=> { root.innerHTML = ''; });
      close.appendChild(closeBtn);
      modal.appendChild(close);

      backdrop.appendChild(modal);
      root.appendChild(backdrop);
    }

    function parseExcelFile(file){
      const reader = new FileReader();
      reader.onload = (e) => {
        let workbook;
        try {
          workbook = XLSX.read(e.target.result, {type:'binary'});
        } catch(err){
          alert('خطأ: الملف غير قابل للقراءة كـ Excel');
          return;
        }
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, {header:1, defval:''});
        if(!rows || rows.length===0){ alert('الملف فارغ'); return; }

        let start = 0, colName = 0, colPhone = 1;
        const first = rows[0].map(c => String(c).trim().toLowerCase());
        if(first.some(x=>x.includes('name')||x.includes('اسم')) && first.some(x=>x.includes('phone')||x.includes('تليفون')||x.includes('mobile'))){
          colName = first.findIndex(x=>x.includes('name')||x.includes('اسم'));
          colPhone = first.findIndex(x=>x.includes('phone')||x.includes('تليفون')||x.includes('mobile'));
          start = 1;
        }

        let added = 0, skipped = 0;
        for(let i=start;i<rows.length;i++){
          const r = rows[i];
          const rawName = r[colName] !== undefined ? r[colName] : '';
          const rawPhone = r[colPhone] !== undefined ? r[colPhone] : '';
          if(String(rawName).trim()==='' && String(rawPhone).trim()==='') continue;
          const c = addOrGetCustomerByName(rawName || 'Unknown');
          const res = addPhoneToCustomer(c.id, rawPhone);
          if(res.ok) added++; else skipped++;
        }
        saveState();
        renderList(document.getElementById('search').value);
        alert('انتهى الاستيراد — أُضيف: ' + added + ' · تم تجاهل: ' + skipped);
      };
      reader.readAsBinaryString(file);
    }

    function exportJSON(){
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'clicklife_export.json'; a.click(); URL.revokeObjectURL(url);
    }

    function importSample(){
      const sample = [
        {name: 'أحمد علي', phone: '01012345678'},
        {name: 'علي محمد', phone: '01111112222'},
        {name: 'منى سالم', phone: '01234567890'}
      ];
      sample.forEach(r => { const c = addOrGetCustomerByName(r.name); addPhoneToCustomer(c.id, r.phone); });
      saveState();
      renderList();
      alert('تم استيراد مثال صغير');
    }

    document.getElementById('btnAdd').addEventListener('click', ()=>{
      const name = prompt('اسم العميل');
      if(!name) return;
      const phone = prompt('رقم (اختياري)');
      const c = addOrGetCustomerByName(name.trim());
      if(phone) addPhoneToCustomer(c.id, phone.trim());
      saveState();
      renderList();
    });

    document.getElementById('btnClear').addEventListener('click', deleteAll);
    document.getElementById('btnImportSample').addEventListener('click', importSample);
    document.getElementById('btnExport').addEventListener('click', exportJSON);

    const fileInput = document.getElementById('file');
    fileInput.addEventListener('change', (e)=> {
      const f = e.target.files[0]; if(f) parseExcelFile(f); e.target.value='';
    });

    document.addEventListener('dragover', (e)=> e.preventDefault());
    document.addEventListener('drop', (e)=> {
      e.preventDefault();
      if(e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0]){
        parseExcelFile(e.dataTransfer.files[0]);
      }
    });

    document.getElementById('search').addEventListener('input', (e)=> { renderList(e.target.value); });

    document.addEventListener('keydown', (e)=>{
      if(e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){ e.preventDefault(); document.getElementById('search').focus(); }
      if((e.key === 'N' || e.key === 'n') && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){ e.preventDefault(); document.getElementById('btnAdd').click(); }
    });

    loadState();
    renderList();
    renderCounts();
  </script>
</body>
</html>
