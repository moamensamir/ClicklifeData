<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clicklife — إدارة العملاء والأرقام</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* -------------------------
       Design: Professional + Human
       - clean, neutral palette
       - generous spacing, clear hierarchy
       - RTL friendly
       ------------------------- */
    :root{
      --bg: #f5f7fb;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #0f62fe;       /* professional blue */
      --accent-2: #0ea56a;     /* supportive green */
      --danger: #ef4444;
      --surface: #f8fbff;
      --radius: 12px;
      --shadow-1: 0 6px 20px rgba(12,30,80,0.06);
      --glass: rgba(255,255,255,0.6);
      font-family: 'Cairo', 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#eef4fb);color:#071133}
    .wrap{max-width:1200px;margin:28px auto;padding:20px}
    header.appHeader{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#6f8cff);
      display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;box-shadow:var(--shadow-1)
    }
    h1{font-size:18px;margin:0}
    .tagline{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;border:0;padding:9px 14px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(15,98,254,0.08)}
    .btn.ghost{background:transparent;border:1px solid rgba(10,30,80,0.06);color:var(--accent);font-weight:600}
    .btn.soft{background:#fff;color:var(--accent);border:1px solid rgba(10,30,80,0.06)}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:980px){ .layout{grid-template-columns:1fr} .asidePanel{order:2} }

    /* panels */
    .panel{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow-1)}
    .searchBar{display:flex;gap:12px;align-items:center}
    input[type="search"]{
      flex:1;padding:12px 14px;border-radius:10px;border:1px solid #e6eef9;background:linear-gradient(180deg,#fff,#fbfdff);
      font-size:15px;direction:ltr
    }
    .small{font-size:13px;color:var(--muted)}

    /* list */
    .listHeader{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px}
    .customersList{margin-top:6px;border-radius:10px;overflow:hidden;border:1px solid #f1f6ff}
    .customerRow{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid #f6fbff;background:linear-gradient(180deg,#fff,#fbfdff)}
    .customerRow:last-child{border-bottom:0}
    .avatar{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .customerMain{flex:1;min-width:0}
    .customerName{font-weight:700}
    .customerMeta{color:var(--muted);font-size:13px;margin-top:4px}
    .rowActions{display:flex;gap:8px;align-items:center}

    /* detail */
    .detailHeader{display:flex;align-items:center;gap:12px}
    .phonesTable{width:100%;border-collapse:collapse;margin-top:12px}
    .phonesTable tr td{padding:10px;border-bottom:1px dashed #f3f9ff}
    .phonesTable tr:last-child td{border-bottom:0}
    .inputInline{padding:8px;border-radius:8px;border:1px solid #eef6ff}
    .pill{display:inline-block;padding:6px 8px;background:#f1faff;border-radius:999px;color:var(--accent);font-weight:700;font-size:13px}

    /* aside */
    .asidePanel .smallCard{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #f6fbff;margin-bottom:12px}
    .badge{display:inline-flex;background:#eef8ff;color:var(--accent);padding:6px 10px;border-radius:999px;font-weight:700}

    /* file drop */
    .dropArea{border:2px dashed #e6eef9;border-radius:12px;padding:18px;text-align:center;color:var(--muted);background:linear-gradient(180deg,transparent,#ffffff00)}
    .dropArea.drag{background:linear-gradient(180deg,#f7fbff,#eef8ff);border-color:var(--accent);box-shadow:0 8px 24px rgba(15,98,254,0.06)}

    /* empty */
    .emptyState{padding:28px;text-align:center;color:var(--muted)}
    .emptyState h3{margin:0 0 8px 0}

    /* toast */
    .toastWrap{position:fixed;left:20px;bottom:20px;z-index:120;display:flex;flex-direction:column;gap:8px}
    .toast{background:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 8px 26px rgba(10,20,30,0.12);border-left:6px solid var(--accent-2)}

    /* utilities */
    .muted{color:var(--muted)}
    .right{float:right}
    .hidden{display:none}
    .kbd{background:#f3f6ff;border-radius:6px;padding:4px 6px;font-weight:700;color:var(--accent);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Clicklife — إدارة العملاء">
    <header class="appHeader">
      <div class="brand" aria-hidden="false">
        <div class="logo" aria-hidden="true">CL</div>
        <div>
          <h1>Clicklife</h1>
          <div class="tagline">دفتر عملاء احترافي — واجهة بشرية وواضحة</div>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <label class="btn soft" for="file">استيراد Excel</label>
        <input id="file" type="file" accept=".xlsx,.xls" style="display:none">
        <button id="btnAdd" class="btn">➕ عميل جديد</button>
        <button id="btnExport" class="btn ghost">تصدير JSON</button>
      </div>
    </header>

    <main class="layout" aria-live="polite">
      <!-- Main column -->
      <section class="panel" aria-label="قائمة العملاء">
        <div class="searchBar" role="search" aria-label="Search customers">
          <input id="search" type="search" placeholder="اكتب اسم العميل، أو جزء منه — اضغط / للتركيز" />
          <div class="small muted">نتائج مباشرة مع تمييز ومطابقة ذكية</div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;justify-content:space-between">
          <div class="small muted">إجمالي العملاء: <span id="countCustomers">0</span></div>
          <div class="small muted">الأرقام الكلية: <span id="countPhones">0</span></div>
        </div>

        <div id="listContainer" class="customersList" style="margin-top:12px">
          <!-- rows inserted here -->
        </div>

        <div style="margin-top:12px;display:flex;align-items:center;gap:8px;justify-content:space-between">
          <div class="small muted">لوحة تنظيم سهلة — انقر لعرض التفاصيل، أو استخدم مفاتيح الاختصار</div>
          <div>
            <button id="prevPage" class="btn soft">السابق</button>
            <button id="nextPage" class="btn soft">التالي</button>
          </div>
        </div>
      </section>

      <!-- Aside -->
      <aside class="panel asidePanel" aria-label="معلومات سريعة">
        <div class="smallCard small">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <div class="muted">الوضع</div>
              <div style="font-weight:700">جهة عمل محلية</div>
            </div>
            <div class="badge" id="phoneSummary">0 أرقام</div>
          </div>
          <div class="muted" style="margin-top:10px;font-size:13px">البيانات مخزنة محلياً في المتصفح. يُمكنك تصديرها للنسخ الاحتياطي.</div>
        </div>

        <div class="smallCard">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div style="font-weight:700">استيراد سريع</div>
            <div class="muted">دعم Excel (.xlsx, .xls)</div>
          </div>

          <div id="dropArea" class="dropArea" tabindex="0" style="margin-top:10px">
            اسحب الملف هنا أو اضغط "استيراد Excel"
            <div class="muted" style="margin-top:8px;font-size:13px">صف يحتوي على اسم وعمود رقم أو اعتمد الأعمدة الأولى</div>
          </div>
        </div>

        <div class="smallCard">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div style="font-weight:700">أدوات</div>
          </div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="btnImportSample" class="btn soft">استيراد مثال</button>
            <button id="btnClear" class="btn ghost">مسح البيانات</button>
          </div>
          <div style="margin-top:12px" class="small muted">اختصارات: / للبحث · N لإضافة</div>
        </div>
      </aside>
    </main>

    <div id="detailModal" class="hidden" role="dialog" aria-modal="true" aria-label="تفاصيل العميل"></div>
    <div class="toastWrap" id="toastWrap" aria-live="assertive" aria-atomic="true"></div>
  </div>

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    /* ============================
       Professional + Human UX: JS
       - clear structure and comments
       - pagination, fuzzy search, keyboard shortcuts
       - accessible modals and toasts
       ============================ */

    // application state
    let state = { customers: [] }; // {id,name,name_norm,phones:[{id,phone,phone_norm}]}
    const LS_KEY = 'clicklife_pro_v1';
    const PAGE_SIZE = 12;
    let currentPage = 0;
    let filtered = null; // when searching

    // utils
    function uid(prefix='id'){ return prefix + '_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2,8); }
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    function normName(s){ return (s||'').toString().normalize('NFKD').replace(/[\u064B-\u0652]/g,'').trim().toLowerCase().replace(/\s+/g,' '); }
    function normPhone(p){ return (p||'').toString().replace(/[^0-9+]/g,'').replace(/^0+/,'0'); }

    // persistence
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); renderCounts(); }
    function loadState(){ const raw = localStorage.getItem(LS_KEY); if(raw){ try{ state = JSON.parse(raw); }catch(e){ state = {customers:[]}; } } else state = {customers:[]}; }

    // toasts
    function toast(msg, tone='ok', ms=3000){
      const wrap = document.getElementById('toastWrap');
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      wrap.appendChild(t);
      setTimeout(()=> { t.style.opacity = '0'; t.style.transform = 'translateY(8px)'; setTimeout(()=> t.remove(),300) }, ms);
    }

    // avatar color
    const AV_COLS = ['#0f62fe','#3b82f6','#8b5cf6','#10b981','#f59e0b','#ef4444'];
    function pickColor(text){ let h=0; for(let i=0;i<text.length;i++) h = (h<<5)-h + text.charCodeAt(i); return AV_COLS[Math.abs(h)%AV_COLS.length]; }

    // CRUD helpers
    function findCustomerByNorm(nn){ return state.customers.find(c => c.name_norm === nn); }
    function addOrGetCustomerByName(name){
      const nn = normName(name || '');
      let c = findCustomerByNorm(nn);
      if(!c){
        c = { id: uid('c'), name: (name||'').toString().trim(), name_norm: nn, phones: [] };
        state.customers.push(c);
      } else {
        if(!c.name && name) c.name = name;
      }
      return c;
    }
    function addPhoneToCustomer(customerId, phone){
      const pnorm = normPhone(phone);
      if(!pnorm) return {ok:false,msg:'الرقم غير صالح'};
      const cust = state.customers.find(x=>x.id===customerId);
      if(!cust) return {ok:false,msg:'العميل غير موجود'};
      if(cust.phones.find(p=>p.phone_norm === pnorm)) return {ok:false,msg:'الرقم موجود بالفعل'};
      const ph = {id: uid('p'), phone: phone.toString().trim(), phone_norm: pnorm};
      cust.phones.push(ph);
      saveState();
      return {ok:true, phone: ph};
    }
    function deleteCustomer(id){ state.customers = state.customers.filter(c=>c.id!==id); saveState(); renderList(); toast('تم حذف العميل'); }

    // Import Excel
    function parseExcelFile(file){
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const workbook = XLSX.read(e.target.result, {type:'binary'});
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(sheet, {header:1, defval:''});
          if(!rows || rows.length===0){ toast('الملف فارغ', 'err'); return; }
          // detect header
          let start = 0, colName = 0, colPhone = 1;
          const first = rows[0].map(c=>String(c).trim().toLowerCase());
          if(first.some(x=>x.includes('name') || x.includes('اسم')) && first.some(x=>x.includes('phone')||x.includes('تليفون')||x.includes('mobile'))){
            colName = first.findIndex(x=>x.includes('name')||x.includes('اسم'));
            colPhone = first.findIndex(x=>x.includes('phone')||x.includes('تليفون')||x.includes('mobile'));
            start = 1;
          }
          let added=0, skipped=0;
          for(let i=start;i<rows.length;i++){
            const r = rows[i];
            const rawName = r[colName] !== undefined ? r[colName] : '';
            const rawPhone = r[colPhone] !== undefined ? r[colPhone] : '';
            if(String(rawName).trim()==='' && String(rawPhone).trim()==='') continue;
            const cust = addOrGetCustomerByName(rawName || 'Unknown');
            const res = addPhoneToCustomer(cust.id, rawPhone);
            if(res.ok) added++; else skipped++;
          }
          saveState();
          renderList();
          toast('تم استيراد الملف — أُضيف: ' + added + '، تم تجاهل: ' + skipped);
        } catch(err){
          console.error(err);
          toast('فشل قراءة الملف', 'err');
        }
      };
      reader.readAsBinaryString(file);
    }

    // rendering
    function renderCounts(){
      const customers = state.customers.length;
      const phones = state.customers.reduce((s,c)=>s + (c.phones?.length||0),0);
      document.getElementById('countCustomers').textContent = customers;
      document.getElementById('countPhones').textContent = phones + ' رقم';
      document.getElementById('phoneSummary').textContent = phones + ' أرقام';
      document.title = `Clicklife — ${customers} عملاء · ${phones} أرقام`;
    }

    function createCustomerRow(c){
      const row = document.createElement('div');
      row.className = 'customerRow';
      // avatar
      const av = document.createElement('div');
      av.className = 'avatar';
      av.style.background = pickColor(c.name || c.id);
      av.textContent = (c.name||'?').split(' ').filter(Boolean).slice(0,2).map(x=>x[0]).join('').toUpperCase();
      row.appendChild(av);

      // main
      const main = document.createElement('div');
      main.className = 'customerMain';
      const nm = document.createElement('div'); nm.className = 'customerName'; nm.textContent = c.name || '—';
      const meta = document.createElement('div'); meta.className='customerMeta';
      meta.innerHTML = '<span class="muted">أرقام: </span>' + (c.phones?.length||0) + ' · ' + '<span class="muted">id:</span> ' + c.id;
      main.appendChild(nm); main.appendChild(meta);
      row.appendChild(main);

      // actions
      const act = document.createElement('div'); act.className = 'rowActions';
      const btnView = document.createElement('button'); btnView.className='btn soft'; btnView.textContent='عرض';
      btnView.addEventListener('click', ()=> openDetail(c.id));
      const btnAdd = document.createElement('button'); btnAdd.className='btn soft'; btnAdd.textContent='إضافة رقم';
      btnAdd.addEventListener('click', ()=> openAddNumberQuick(c.id));
      const btnDel = document.createElement('button'); btnDel.className='btn ghost'; btnDel.textContent='حذف';
      btnDel.addEventListener('click', ()=> { if(confirm('هل تريد حذف العميل؟')) deleteCustomer(c.id); });

      act.appendChild(btnView); act.appendChild(btnAdd); act.appendChild(btnDel);
      row.appendChild(act);

      return row;
    }

    function renderList(){
      const container = document.getElementById('listContainer');
      container.innerHTML = '';
      const listSource = filtered !== null ? filtered : state.customers;
      if(listSource.length === 0){
        container.innerHTML = '<div class="emptyState"><h3>لا توجد بيانات بعد</h3><div class="muted">اضغط "إضافة عميل" أو استورد ملف Excel لبدء العمل.</div></div>';
        renderCounts();
        return;
      }
      const start = currentPage * PAGE_SIZE;
      const page = listSource.slice(start, start + PAGE_SIZE);
      page.forEach(c => container.appendChild(createCustomerRow(c)));
      renderCounts();
    }

    // detail modal (accessible)
    function openDetail(customerId){
      const c = state.customers.find(x=>x.id===customerId);
      if(!c) return;
      const modal = document.getElementById('detailModal');
      modal.className = 'panel';
      modal.style.position='fixed';
      modal.style.left='50%';
      modal.style.top='50%';
      modal.style.transform='translate(-50%,-50%)';
      modal.style.zIndex = 200;
      modal.style.maxWidth = '760px';
      modal.style.width = '94%';
      modal.innerHTML = ''; // build content
      const h = document.createElement('div'); h.className='detailHeader';
      const av = document.createElement('div'); av.className='avatar'; av.style.background = pickColor(c.name); av.style.width='60px'; av.style.height='60px'; av.style.borderRadius='12px'; av.style.fontSize='18px';
      av.textContent = (c.name||'?').split(' ').filter(Boolean).slice(0,2).map(x=>x[0]).join('').toUpperCase();
      h.appendChild(av);
      const info = document.createElement('div'); info.innerHTML = `<div style="font-weight:700">${escapeHtml(c.name)}</div><div class="muted">id: ${c.id}</div>`;
      h.appendChild(info);

      const closeBtn = document.createElement('button'); closeBtn.className='btn ghost'; closeBtn.textContent='إغلاق';
      closeBtn.style.marginLeft='auto'; closeBtn.addEventListener('click', closeModal);
      h.appendChild(closeBtn);
      modal.appendChild(h);

      // phones
      const tbl = document.createElement('table'); tbl.className='phonesTable';
      c.phones.forEach(ph=>{
        const tr = document.createElement('tr');
        const td1 = document.createElement('td'); td1.innerHTML = `<strong>${escapeHtml(ph.phone)}</strong><div class="muted">id: ${ph.id}</div>`;
        const td2 = document.createElement('td');
        const copy = document.createElement('button'); copy.className='btn soft'; copy.textContent='نسخ';
        copy.addEventListener('click', ()=> { navigator.clipboard?.writeText(ph.phone); toast('تم النسخ'); });
        const del = document.createElement('button'); del.className='btn ghost'; del.textContent='حذف';
        del.addEventListener('click', ()=> {
          if(!confirm('حذف رقم؟')) return;
          c.phones = c.phones.filter(p=>p.id!==ph.id); saveState(); renderList(); openDetail(customerId); toast('تم حذف الرقم');
        });

        td2.appendChild(copy); td2.appendChild(del);
        tr.appendChild(td1); tr.appendChild(td2);
        tbl.appendChild(tr);
      });
      modal.appendChild(tbl);

      // add phone form inline
      const addWrap = document.createElement('div'); addWrap.style.marginTop='12px';
      const inp = document.createElement('input'); inp.className='inputInline'; inp.placeholder='أدخل رقم جديد';
      const btn = document.createElement('button'); btn.className='btn'; btn.textContent='حفظ'; btn.style.marginRight='8px';
      btn.addEventListener('click', ()=> {
        const ph = inp.value.trim();
        const res = addPhoneToCustomer(customerId, ph);
        if(!res.ok){ toast(res.msg, 'err'); return; }
        inp.value=''; openDetail(customerId); toast('تم إضافة الرقم');
      });
      addWrap.appendChild(btn); addWrap.appendChild(inp);
      modal.appendChild(addWrap);

      // trap focus (simple)
      modal.tabIndex = -1; modal.focus();
    }

    function closeModal(){
      const modal = document.getElementById('detailModal');
      modal.className = 'hidden';
      modal.style = null;
      modal.innerHTML = '';
    }

    // quick add number modal (small form)
    function openAddNumberQuick(customerId){
      const c = state.customers.find(x=>x.id===customerId);
      if(!c) return;
      const phone = prompt('أدخل الرقم الجديد للعميل ' + c.name);
      if(!phone) return;
      const res = addPhoneToCustomer(customerId, phone.trim());
      if(!res.ok) { toast(res.msg, 'err'); return; }
      renderList(); toast('تم إضافة الرقم');
    }

    // add customer flow (simple modal)
    function openAddCustomer(){
      const name = prompt('اسم العميل');
      if(!name) return;
      const phone = prompt('رقم (اختياري)');
      const c = addOrGetCustomerByName(name.trim());
      if(phone) {
        const res = addPhoneToCustomer(c.id, phone.trim());
        if(!res.ok) toast(res.msg,'err');
      }
      saveState(); renderList(); toast('تم إضافة العميل');
    }

    // search (simple fuzzy: substring on normalized name)
    function doSearch(q){
      if(!q) { filtered = null; currentPage = 0; renderList(); return; }
      const qn = normName(q);
      filtered = state.customers.filter(c => c.name_norm.includes(qn));
      currentPage = 0;
      renderList();
    }

    // pagination controls
    document.getElementById('prevPage').addEventListener('click', ()=> { if(currentPage>0) { currentPage--; renderList(); } });
    document.getElementById('nextPage').addEventListener('click', ()=> { const src = filtered !== null ? filtered : state.customers; if((currentPage+1)*PAGE_SIZE < src.length){ currentPage++; renderList(); } });

    // file and drag/drop
    const fileInput = document.getElementById('file');
    fileInput.addEventListener('change', (e)=> { const f = e.target.files[0]; if(f) parseExcelFile(f); e.target.value=''; });

    const dropArea = document.getElementById('dropArea');
    ['dragenter','dragover'].forEach(ev=> dropArea.addEventListener(ev, (e)=>{ e.preventDefault(); dropArea.classList.add('drag'); }));
    ['dragleave','dragend','drop'].forEach(ev=> dropArea.addEventListener(ev, (e)=>{ e.preventDefault(); if(ev==='drop'){ const f = e.dataTransfer.files[0]; if(f) parseExcelFile(f); } dropArea.classList.remove('drag'); }));
    dropArea.addEventListener('keydown', (e)=> { if(e.key==='Enter') fileInput.click(); });

    // export JSON
    document.getElementById('btnExport').addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'clicklife_export.json'; a.click(); URL.revokeObjectURL(url);
      toast('تم تنزيل ملف JSON');
    });

    // import sample
    document.getElementById('btnImportSample').addEventListener('click', ()=>{
      const sample = [
        {name: 'أحمد علي', phone: '01012345678'},
        {name: 'أحمد علي', phone: '01198765432'},
        {name: 'منى سالم', phone: '01234567890'},
        {name: 'علي حسن', phone: '01055551234'}
      ];
      sample.forEach(r => { const c = addOrGetCustomerByName(r.name); addPhoneToCustomer(c.id, r.phone); });
      saveState(); renderList(); toast('تم استيراد مثال صغير');
    });

    // clear data
    document.getElementById('btnClear').addEventListener('click', ()=> {
      if(!confirm('هل تريد مسح كل البيانات المخزنة محلياً؟')) return;
      localStorage.removeItem(LS_KEY);
      loadState(); renderList(); toast('تم مسح البيانات');
    });

    // add customer
    document.getElementById('btnAdd').addEventListener('click', ()=> openAddCustomer());

    // search input
    document.getElementById('search').addEventListener('input', (e)=> { doSearch(e.target.value); });

    // keyboard shortcuts: / focus search, N add, Esc close modal
    document.addEventListener('keydown', (e)=>{
      if(e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){ e.preventDefault(); document.getElementById('search').focus(); }
      if((e.key === 'N' || e.key === 'n') && (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA')){ e.preventDefault(); openAddCustomer(); }
      if(e.key === 'Escape'){ closeModal(); }
    });

    // initial load
    loadState();
    renderList();

    // small accessibility: announce counts on load
    setTimeout(()=> { const c = state.customers.length; const p = state.customers.reduce((s,x)=>s + (x.phones?.length||0),0); if(c === 0) toast('لا توجد بيانات. استورد ملف أو أضف عميلًا.'); }, 400);
  </script>
</body>
</html>
